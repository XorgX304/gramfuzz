

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>gramfuzz.fields &mdash; gramfuzz v1.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> gramfuzz
          

          
          </a>

          
            
            
              <div class="version">
                v1.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../gramfuzz.html">gramfuzz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fields.html">fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rand.html">rand</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gramfuzz</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../gramfuzz.html">gramfuzz</a> &raquo;</li>
        
      <li>gramfuzz.fields</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gramfuzz.fields</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># encoding: utf-8</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module defines all of the core gramfuzz fields:</span>

<span class="sd">* Float</span>
<span class="sd">* UFloat</span>
<span class="sd">* Int</span>
<span class="sd">* UInt</span>
<span class="sd">* Join</span>
<span class="sd">* Opt</span>
<span class="sd">* Or</span>
<span class="sd">* Q</span>
<span class="sd">* Ref</span>
<span class="sd">* String</span>

<span class="sd">Each field has a ``build()`` method, which accepts one argument</span>
<span class="sd">(``pre``) that can be used to assign prerequisites of the build result.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">six</span>


<span class="kn">from</span> <span class="nn">gramfuzz</span> <span class="kn">import</span> <span class="n">GramFuzzer</span>
<span class="kn">import</span> <span class="nn">gramfuzz.errors</span> <span class="k">as</span> <span class="nn">errors</span>
<span class="kn">import</span> <span class="nn">gramfuzz.rand</span> <span class="k">as</span> <span class="nn">rand</span>
<span class="kn">import</span> <span class="nn">gramfuzz.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">gramfuzz.utils</span> <span class="kn">import</span> <span class="n">binstr</span><span class="p">,</span> <span class="n">maybe_binstr</span>


<div class="viewcode-block" id="MetaField"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.MetaField">[docs]</a><span class="k">class</span> <span class="nc">MetaField</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Used as the metaclass of the core :any:`gramfuzz.fields.Field` class. ``MetaField``</span>
<span class="sd">    defines ``__and__`` and ``__or__`` and ``__repr__`` methods.</span>
<span class="sd">    The overridden and and or operatories allow classes themselves</span>
<span class="sd">    to be wrapped in an :any:`gramfuzz.fields.And` or :any:`gramfuzz.fields.Or`</span>
<span class="sd">    without having to instantiate them first.</span>

<span class="sd">    E.g. the two lines below are equivalent:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">        And(Int(), Float())</span>
<span class="sd">        (Int &amp; Float)</span>

<span class="sd">        Or(Int(), Float())</span>
<span class="sd">        (Int | Float)</span>

<span class="sd">    Do note however that this can only be done if the first (farthest</span>
<span class="sd">    to the left) operand is a Field class or instance.</span>

<span class="sd">    E.g. the first line below will work, but the second line will not will not:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        Or(5, Int)</span>
<span class="sd">        5 | Int</span>

<span class="sd">    It is also recommended that using the overloaded ``&amp;`` and ``|`` operators should</span>
<span class="sd">    only be done in very simple cases, since it is impossible for the code</span>
<span class="sd">    to know the difference between the two statements below:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">            (Int | Float) | Uint</span>
<span class="sd">            Int | Float | UInt</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wraps this field and the other field in an ``And``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">And</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wraps this field and the other field in an ``Or``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Or</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Field">[docs]</a><span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">MetaField</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;The core class that all field classes are based one. Contains</span>
<span class="sd">    utility methods to determine probabilities/choices/min-max/etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shortest_is_nothing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;This is used during :any:`gramfuzz.GramFuzzer.find_shortest_paths`. Sometimes</span>
<span class="sd">    the fuzzer cannot know based on the values in a field what that field&#39;s</span>
<span class="sd">    minimal behavior will be.</span>

<span class="sd">    Setting this to ``True`` will explicitly let the ``GramFuzzer`` instance</span>
<span class="sd">    know what the minimal outcome will be.</span>

<span class="sd">    *NOTE* when implementing a custom Field subclass and setting ``shortest_is_nothing``</span>
<span class="sd">    to ``True``, be sure to handle the case when ``build(shortest=True)``</span>
<span class="sd">    is called so that a ``gramfuzz.errors.OptGram`` error is raised (which</span>
<span class="sd">    skips the current field from being generated).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="mh">0x100</span>

    <span class="n">odds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;``odds`` is a list of tuples that define probability values.</span>
<span class="sd">    </span>
<span class="sd">    Each item in the list must be a tuple of the form:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        (X, Y)</span>

<span class="sd">    Where ``X`` is the probability percent, and where ``Y`` is one of</span>
<span class="sd">    the following:</span>

<span class="sd">    * A single value</span>
<span class="sd">    * A list/tuple containing two values, the min and max of a range of numbers.</span>

<span class="sd">    Note that the sum of each probability percent in the list must equal 1.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap this field and the other field in an ``And``</span>

<span class="sd">        :param  other: Another ``Field`` class, instance, or python object to ``Or`` with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">And</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">And</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap this field and the other field in an ``Or``</span>

<span class="sd">        :param  other: Another ``Field`` class, instance, or python object to ``Or`` with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Or</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Or</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">rolling</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_odds_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine a new random value derived from the</span>
<span class="sd">        defined :any:`gramfuzz.fields.Field.odds` value.</span>

<span class="sd">        :returns: The derived value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">odds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1.00</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">])]</span>

        <span class="n">rand_val</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">percent</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">odds</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;=</span> <span class="n">rand_val</span> <span class="o">&lt;</span> <span class="n">total</span><span class="o">+</span><span class="n">percent</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">percent</span>

        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">rand_func</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">randfloat</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">rand</span><span class="o">.</span><span class="n">randint</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">rand_func</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">res</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;&gt;&quot;</span>
        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="Int"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Int">[docs]</a><span class="k">class</span> <span class="nc">Int</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents all Integers, with predefined odds that target</span>
<span class="sd">    boundary conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="mh">0x10000003</span>

    <span class="n">odds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mh">0x80</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mh">0x80</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x80</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x80</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mh">0x100</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mh">0x100</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x100</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x100</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mh">0x10000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x10000</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x10000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x10000</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span>    <span class="mh">0x80000000</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span>    <span class="o">-</span><span class="mh">0x80000000</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mh">0x100000000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x100000000</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x100000000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x100000000</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="p">]</span>

<div class="viewcode-block" id="Int.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Int.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new Int object, optionally specifying a hard-coded value</span>

<span class="sd">        :param int value: The value of the new int object</span>
<span class="sd">        :param int min: The minimum value (if value is not specified)</span>
<span class="sd">        :param int max: The maximum value (if value is not specified)</span>
<span class="sd">        :param list odds: The probability list. See ``Field.odds`` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s2">&quot;min&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s2">&quot;max&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;odds&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">odds</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Int.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Int.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the integer, optionally providing a ``pre`` list</span>
<span class="sd">        that *may* be used to define prerequisites for a Field being built.</span>

<span class="sd">        :param list pre: A list of prerequisites to be collected during the building of a Field.</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rand</span><span class="o">.</span><span class="n">maybe</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_odds_val</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="UInt"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.UInt">[docs]</a><span class="k">class</span> <span class="nc">UInt</span><span class="p">(</span><span class="n">Int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Defines an unsigned integer ``Field``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">neg</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">odds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x80</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x80</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x100</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x100</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x10000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x10000</span><span class="o">+</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span>    <span class="mh">0x80000000</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.02</span><span class="p">,</span>    <span class="p">[</span><span class="mh">0x100000000</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x100000000</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="Float"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Float">[docs]</a><span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Defines a float ``Field`` with odds that define float</span>
<span class="sd">    values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">odds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="o">-</span><span class="mf">100000.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1000.0</span><span class="p">]),</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="UFloat"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.UFloat">[docs]</a><span class="k">class</span> <span class="nc">UFloat</span><span class="p">(</span><span class="n">Float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Defines an unsigned float field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">odds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span>    <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">]),</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="String"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.String">[docs]</a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">UInt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Defines a string field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="mh">0x100</span>

    <span class="n">odds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.85</span><span class="p">,</span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">]),</span>
        <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span>    <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.025</span><span class="p">,</span>    <span class="mi">0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.025</span><span class="p">,</span>    <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">]),</span>
    <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;Unlike numeric ``Field`` types, the odds value for the ``String`` field</span>
<span class="sd">    defines the *length* of the field, not characters used in the string.</span>

<span class="sd">    See the :any:`gramfuzz.fields.Field.odds` member for details on the format of the ``odds`` probability</span>
<span class="sd">    list.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_alpha_lower</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
    <span class="sd">&quot;&quot;&quot;A lower-case alphabet character set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_alpha_upper</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    <span class="sd">&quot;&quot;&quot;An upper-case alphabet character set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_alpha</span> <span class="o">=</span> <span class="n">charset_alpha_lower</span> <span class="o">+</span> <span class="n">charset_alpha_upper</span>
    <span class="sd">&quot;&quot;&quot;Upper- and lower-case alphabet</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_spaces</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n\r\t</span><span class="s2"> &quot;</span>
    <span class="sd">&quot;&quot;&quot;Whitespace character set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_num</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;1234567890&quot;</span>
    <span class="sd">&quot;&quot;&quot;Numeric character set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_alphanum</span> <span class="o">=</span> <span class="n">charset_alpha</span> <span class="o">+</span> <span class="n">charset_num</span>
    <span class="sd">&quot;&quot;&quot;Alpha-numeric character set (upper- and lower-case alphabet + numbers)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset_all</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binstr</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mh">0x100</span><span class="p">))</span>
    <span class="sd">&quot;&quot;&quot;All possible binary characters (``0x0-0xff``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">charset</span> <span class="o">=</span> <span class="n">charset_alpha</span>
    <span class="sd">&quot;&quot;&quot;The default character set of the ``String`` field class (default=charset_alpha)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="String.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.String.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new instance of the ``String`` field.</span>

<span class="sd">        :param value: The hard-coded value of the String field</span>
<span class="sd">        :param int min: The minimum size of the String when built</span>
<span class="sd">        :param int max: The maximum size of the String when built</span>
<span class="sd">        :param str charset: The character-set to be used when building the string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">binstr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;charset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">))</span></div>

<div class="viewcode-block" id="String.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.String.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the String instance</span>

<span class="sd">        :param list pre: The prerequisites list (optional, default=None)</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rand</span><span class="o">.</span><span class="n">maybe</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div></div>

<div class="viewcode-block" id="Join"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Join">[docs]</a><span class="k">class</span> <span class="nc">Join</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that joins other values with a separator.</span>
<span class="sd">    This class works nicely with ``Opt`` values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">sep</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;,&quot;</span>

<div class="viewcode-block" id="Join.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Join.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new instance of the ``Join`` class.</span>

<span class="sd">        :param list values: The values to join</span>
<span class="sd">        :param str sep: The string with which to separate each of the values (default=``&quot;,&quot;``)</span>
<span class="sd">        :param int max: The maximum number of times (inclusive) to build the first item in ``values``.</span>
<span class="sd">            This can be useful when a variable number of items in a list is needed. E.g.:</span>

<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                Join(Int, max=5, sep=&quot;,&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">binstr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Join.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Join.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the ``Join`` field instance.</span>
<span class="sd">        </span>
<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shortest</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># +1 to make it inclusive</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">rand</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

        <span class="n">joins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>
                <span class="n">joins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">joins</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="And"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.And">[docs]</a><span class="k">class</span> <span class="nc">And</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that concatenates two values together.</span>
<span class="sd">    This class works nicely with ``Opt`` values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sep</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="And.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.And.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``And`` field instance.</span>
<span class="sd">        </span>
<span class="sd">        :param list values: The list of values to be concatenated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">binstr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="c1"># to be used internally, is not intended to be set directly by a user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rolling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rolling&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">GramFuzzer</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="And.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.And.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the ``And`` instance</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">FlushGrams</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="c1"># this is assuming a scope was pushed!</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">_scope_stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">_curr_scope</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;prev_append&quot;</span><span class="p">,</span> <span class="n">deque</span><span class="p">())</span>
                    <span class="n">stmts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pre</span><span class="p">)</span>
                    <span class="n">stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
                    <span class="n">pre</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Q"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Q">[docs]</a><span class="k">class</span> <span class="nc">Q</span><span class="p">(</span><span class="n">And</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that quotes whatever value is provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">escape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;Whether or not the quoted data should be escaped (default=``False``). Uses ``repr(X)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">html_js_escape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;Whether or not the quoted data should be html-javascript escaped (default=``False``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">quote</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&quot;&#39;</span>
    <span class="sd">&quot;&quot;&quot;Which quote character to use if ``escape`` and ``html_js_escape`` are False (default=``&#39;&quot;&#39;``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Q.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Q.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the new ``Quote`` instance</span>

<span class="sd">        :param bool escape: Whether or not quoted data should be escaped (default=``False``)</span>
<span class="sd">        :param bool html_js_escape: Whether or not quoted data should be html-javascript escaped (default=``False``)</span>
<span class="sd">        :param str quote: The quote character to be used if ``escape`` and ``html_js_escape`` are ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">escape</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;escape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_js_escape</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;html_js_escape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_js_escape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quote</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_repr_escape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a repr escape on &#39;val&#39;, trimming the ``b`` off of the</span>
<span class="sd">        resulting data, if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">binstr</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="c1"># this is safe - res after repr will always start with either a</span>
        <span class="c1"># single quote or a double quote</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;b&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">res</span>

<div class="viewcode-block" id="Q.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Q.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the ``Quote`` instance</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_escape</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_js_escape</span><span class="p">:</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">escape_encode</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x3c&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x3e&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="Or"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Or">[docs]</a><span class="k">class</span> <span class="nc">Or</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that chooses one of the provided values</span>
<span class="sd">    at random as the result of a call to the ``build()`` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Or.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Or.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``Or`` instance with the provide values</span>

<span class="sd">        :param list values: The list of values to choose randomly from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># when building with shortest=True, one of these values will</span>
        <span class="c1"># be chosen instead of self.values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortest_indices</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rolling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rolling&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Or.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Or.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the ``Or`` instance</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal)</span>
<span class="sd">            version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># self.shortest_vals will be set by the GramFuzzer and will</span>
        <span class="c1"># contain a list of value options that have a minimal reference</span>
        <span class="c1"># chain</span>
        <span class="c1"># </span>
        <span class="c1"># see https://narly.me/posts/controlling-recursion-depth-in-grammars/</span>
        <span class="c1"># for an in-depth discussion</span>
        <span class="k">if</span> <span class="n">shortest</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chosen_val</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chosen_val</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="n">chosen_val</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="WeightedOr"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.WeightedOr">[docs]</a><span class="k">class</span> <span class="nc">WeightedOr</span><span class="p">(</span><span class="n">Or</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that chooses one of the provided values at</span>
<span class="sd">    random as the result of a call to the ``build()`` method. Takes an</span>
<span class="sd">    odds array rather than just direct values. Also aliased to ``WOr``.</span>

<span class="sd">    E.g.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        WeightedOr(</span>
<span class="sd">            (&quot;hello&quot;, 0.1), # 10% chance</span>
<span class="sd">            (UInt,    0.7), # 70% chance</span>
<span class="sd">            (3.14,    0.3), # 30% chance</span>
<span class="sd">        )</span>

<span class="sd">        # or</span>

<span class="sd">        WOr(</span>
<span class="sd">            (&quot;hello&quot;, 0.1), # 10% chance</span>
<span class="sd">            (UInt,    0.7), # 70% chance</span>
<span class="sd">            (3.14,    0.3), # 30% chance</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WeightedOr.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.WeightedOr.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``WeightedOr`` instance with the provided values.</span>

<span class="sd">        :param list values: A list of tuples of the form</span>
<span class="sd">                            ``[(value, probability), ...]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># when building with shortest=True, one of these values will</span>
        <span class="c1"># be chosen instead of self.values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># this will also be set by the GramFuzzer and indicates the index within</span>
        <span class="c1"># self.values of each shortest_val so that the correct weight can be used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortest_indices</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">vals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Weights in WeightedOr don&#39;t sum to 1.0: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rolling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rolling&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="WeightedOr.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.WeightedOr.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) </span>
<span class="sd">            version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># self.shortest_vals will be set by the GramFuzzer and will</span>
        <span class="c1"># contain a list of value options that have a minimal reference chain</span>
        <span class="c1"># </span>
        <span class="c1"># see https://narly.me/posts/controlling-recursion-depth-in-grammars/</span>
        <span class="c1"># for an in-depth discussion</span>
        <span class="k">if</span> <span class="n">shortest</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chosen_weights</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_indices</span><span class="p">]</span>
            <span class="n">chosen_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_vals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chosen_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
            <span class="n">chosen_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">weighted_choice</span><span class="p">(</span><span class="n">chosen_vals</span><span class="p">,</span> <span class="n">chosen_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span></div></div>
<span class="n">WOr</span> <span class="o">=</span> <span class="n">WeightedOr</span>


<div class="viewcode-block" id="Opt"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Opt">[docs]</a><span class="k">class</span> <span class="nc">Opt</span><span class="p">(</span><span class="n">And</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A ``Field`` subclass that randomly chooses to either build the</span>
<span class="sd">    provided values (acts as an ``And`` in that case), or raise an</span>
<span class="sd">    ``errors.OptGram`` exception.</span>

<span class="sd">    When an ``errors.OptGram`` exception is raised, the current value being built</span>
<span class="sd">    is then skipped</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shortest_is_nothing</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">prob</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="sd">&quot;&quot;&quot;The probability of an ``Opt`` instance raising an ``errors.OptGram``</span>
<span class="sd">    exception</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Opt.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Opt.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``Opt`` instance</span>

<span class="sd">        :param list values: The list of values to build (or not)</span>
<span class="sd">        :param float prob: A float value between 0 and 1 that defines the probability</span>
<span class="sd">        of cancelling the current build.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Opt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;prob&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">)</span></div>

<div class="viewcode-block" id="Opt.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Opt.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the current ``Opt`` instance</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">shortest</span> <span class="ow">or</span> <span class="n">rand</span><span class="o">.</span><span class="n">maybe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Opt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span></div></div>

<span class="c1"># ----------------------------</span>
<span class="c1"># Non-direct classes</span>
<span class="c1"># ----------------------------</span>

<div class="viewcode-block" id="Def"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Def">[docs]</a><span class="k">class</span> <span class="nc">Def</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The ``Def`` class is used to define grammar *rules*. A defined rule</span>
<span class="sd">    has three parts:</span>

<span class="sd">    # Name - A rule name can be declared multiple times. When a rule name with multiple</span>
<span class="sd">    definitions is generated, one of the rule definitions will be chosen at random.</span>

<span class="sd">    # Values - The values of the rule. These will be concatenated (acts the same</span>
<span class="sd">    as an ``And``).</span>

<span class="sd">    # Category - Which category to define the rule in. This is an important step and</span>
<span class="sd">    guides the fuzzer into choosing the correct rule definitions when randomly choosing</span>
<span class="sd">    rules to generate.</span>

<span class="sd">    For example, supposed we defined a grammar for various types of postal addresses.</span>
<span class="sd">    We could have a grammar for US addresses, UK addresses, and Australian addresses.</span>
<span class="sd">    When we want the fuzzer to generate a random address, we would want it to choose</span>
<span class="sd">    one from our US, UK, or Australian address rule and not choose to generate only</span>
<span class="sd">    a zipcode rule.</span>

<span class="sd">    I often have a main ``X`` category, as well as an ``X_def`` category. The ``X``</span>
<span class="sd">    category is what I tell to the fuzzer to choose from when randomly generating</span>
<span class="sd">    top-level rules. The ``X_def`` category is only used to help build the top-level</span>
<span class="sd">    rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sep</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot;The separator of values for this rule definition (default=``&quot;&quot;``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">no_prune</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;Whether or not this rule should be pruned if the fuzzer cannot find</span>
<span class="sd">    a way to reach this rule. (default=``False``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="sd">&quot;&quot;&quot;The default category of this ``Def`` class (default=``&quot;default&quot;``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Def.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Def.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new rule definition. Simply instantiating a new rule definition</span>
<span class="sd">        will add it to the current ``GramFuzzer`` instance.</span>

<span class="sd">        :param str name: The name of the rule being defined</span>
<span class="sd">        :param list values: The list of values that define the value of the rule</span>
<span class="sd">            (will be concatenated when built)</span>
<span class="sd">        :param str cat: The category to create the rule in (default=``&quot;default&quot;``).</span>
<span class="sd">        :param bool no_prune: If this rule should not be pruned *EVEN IF* it is found to be</span>
<span class="sd">            unreachable (default=``False``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">maybe_binstr</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">binstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_prune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;no_prune&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_prune</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">GramFuzzer</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

        <span class="n">frame</span><span class="p">,</span><span class="n">mod_path</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mod_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pyc&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;TOP_CAT&quot;</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">cat_group_defaults</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s2">&quot;TOP_CAT&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">add_definition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">no_prune</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_prune</span><span class="p">,</span> <span class="n">gram_file</span><span class="o">=</span><span class="n">module_name</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Def.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Def.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build this rule definition</span>
<span class="sd">        </span>
<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">FlushGrams</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="c1"># this is assuming a scope was pushed!</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">_scope_stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">_curr_scope</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;prev_append&quot;</span><span class="p">,</span> <span class="n">deque</span><span class="p">())</span>
                    <span class="n">stmts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pre</span><span class="p">)</span>
                    <span class="n">stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
                    <span class="n">pre</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">GramFuzzError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="k">raise</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div></div>

<span class="n">REF_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
<div class="viewcode-block" id="Ref"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Ref">[docs]</a><span class="k">class</span> <span class="nc">Ref</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The ``Ref`` class is used to reference defined rules by their name. If a</span>
<span class="sd">    rule name is defined multiple times, one will be chosen at random.</span>

<span class="sd">    For example, suppose we have a rule that returns an integer:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        Def(&quot;integer&quot;, UInt)</span>

<span class="sd">    We could define another rule that creates a ``Float`` by referencing the</span>
<span class="sd">    integer rule twice, and placing a period between them:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        Def(&quot;float&quot;, Ref(&quot;integer&quot;), &quot;.&quot;, Ref(&quot;integer&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="sd">&quot;&quot;&quot;The default category where the referenced rule definition will be looked for</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_recursion</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">failsafe</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Ref.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Ref.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new ``Ref`` instance</span>

<span class="sd">        :param str refname: The name of the rule to reference</span>
<span class="sd">        :param str cat: The name of the category the rule is defined in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refname</span> <span class="o">=</span> <span class="n">refname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failsafe</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;failsafe&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">failsafe</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">GramFuzzer</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Ref.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.Ref.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the ``Ref`` instance by fetching the rule from</span>
<span class="sd">        the GramFuzzer instance and building it</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">REF_LEVEL</span>
        <span class="n">REF_LEVEL</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1">#print(&quot;{:04d} - {} - {}:{}&quot;.format(REF_LEVEL, shortest, self.cat, self.refname))</span>

            <span class="n">definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">get_ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refname</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">val</span><span class="p">(</span>
                <span class="n">definition</span><span class="p">,</span>
                <span class="n">pre</span><span class="p">,</span>
                <span class="n">shortest</span><span class="o">=</span><span class="p">(</span><span class="n">shortest</span> <span class="ow">or</span> <span class="n">REF_LEVEL</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_recursion</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">res</span>

        <span class="c1"># this needs to happen no matter what</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">REF_LEVEL</span> <span class="o">-=</span> <span class="mi">1</span></div>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">[</span><span class="si">{}</span><span class="s2">]&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refname</span><span class="p">)</span></div>


<span class="c1"># -------------------------------------</span>
<span class="c1"># syntactic sugar</span>
<span class="c1"># -------------------------------------</span>


<div class="viewcode-block" id="PLUS"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.PLUS">[docs]</a><span class="k">class</span> <span class="nc">PLUS</span><span class="p">(</span><span class="n">Join</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Acts like the + in a regex - one or more of the values.</span>
<span class="sd">    The values are Anded together one or more times, up to ``max``</span>
<span class="sd">    times.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="PLUS.__init__"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.PLUS.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PLUS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="STAR"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.STAR">[docs]</a><span class="k">class</span> <span class="nc">STAR</span><span class="p">(</span><span class="n">PLUS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Acts like the ``*`` in a regex - zero or more of the values.</span>
<span class="sd">    The values are Anded together zero or more times, up to ``max``</span>
<span class="sd">    times.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shortest_is_nothing</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="STAR.build"><a class="viewcode-back" href="../../fields.html#gramfuzz.fields.STAR.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the STAR field.</span>

<span class="sd">        :param list pre: The prerequisites list</span>
<span class="sd">        :param bool shortest: Whether or not the shortest reference-chain (most minimal) version of the field should be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pre</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">shortest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span>
        <span class="k">elif</span> <span class="n">rand</span><span class="o">.</span><span class="n">maybe</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">STAR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">shortest</span><span class="o">=</span><span class="n">shortest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">OptGram</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, James &#39;d0c_s4vage&#39; Johnson

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>